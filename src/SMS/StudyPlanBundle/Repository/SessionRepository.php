<?php

namespace SMS\StudyPlanBundle\Repository;

use Doctrine\ORM\EntityRepository;

/**
 * SessionRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class SessionRepository extends EntityRepository
{

	/**
     * Get Session By Section And Date
     *
     * @return array
     */
	public function findAllByStartTime($establishment)
	{
		return $this->createQueryBuilder('session')
					->select('partial session.{id,sessionName,startTime,endTime}')
					->join('session.establishment', 'establishment')
					->andWhere('establishment.id = :establishment')
					->setParameter('establishment', $establishment)
					->orderBy('session.startTime',"asc")
					->getQuery()
					->getResult();
	}

	/**
     * Get Session By Section And Date
     *
     * @param integer $section
     * @param String $day
     * @param integer $division
     * @return array
     */
	public function findBySectionAndDateAndDivision($section , $day ,$division, $establishment)
	{
		return $this->createQueryBuilder('session')
				->join('session.schedules', 'schedule')
				->join('session.establishment', 'establishment')
				->join('schedule.course', 'course')
				->join('course.division', 'division')
				->join('schedule.section', 'section')
				->Where('section.id = :section')
				->andWhere('schedule.day = :day')
				->andWhere('establishment.id = :establishment')
				->andWhere('division.id = :division')
				->setParameter('day', $day)
				->setParameter('section', $section)
				->setParameter('establishment', $establishment)
				->setParameter('division', $division)
				->getQuery()
				->getResult();
	}

	/**
     * Get Session By Professor And Date
     *
     * @param integer $professor
     * @param String $day
     * @param integer $division
     * @return array
     */
	public function findByProfessorAndDateAndDivision($professor , $day ,$division , $establishment)
	{
		return $this->createQueryBuilder('session')
				->join('session.schedules', 'schedule')
				->join('schedule.course', 'course')
				->join('session.establishment', 'establishment')
				->join('course.division', 'division')
				->join('schedule.professor', 'professor')
				->Where('professor.id = :professor')
				->andWhere('schedule.day = :day')
				->andWhere('establishment.id = :establishment')
				->andWhere('division.id = :division')
				->setParameter('day', $day)
				->setParameter('establishment', $establishment)
				->setParameter('professor', $professor)
				->setParameter('division', $division)
				->getQuery()
				->getResult();
	}
}
