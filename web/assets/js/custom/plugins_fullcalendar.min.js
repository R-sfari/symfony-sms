$(function() {

    // fullcalendar
    altair_fullcalendar.calendar_selectable();
    //function to calculate window height
});

altair_fullcalendar = {
    responsive: function() {
        if ($(window).width() < 514) {
            $('.fc-agendaWeek-button').hide();
            $('.fc-listWeek-button').hide();
        } else {
            $('.fc-agendaWeek-button').show();
            $('.fc-listWeek-button').show();
            $('#calendar_selectable').fullCalendar('changeView', 'month');
        }
    },
    calendar_selectable: function() {

        var $calendar_selectable = $('#calendar_selectable'),
            calendarColorsWrapper = $('<div id="calendar_colors_wrapper"></div>');

        var calendarColorPicker = altair_helpers.color_picker(calendarColorsWrapper).prop('outerHTML');

        if ($calendar_selectable.length) {
            $calendar_selectable.fullCalendar({
                header: {
                    left: 'title today',
                    center: '',
                    right: 'month,agendaWeek,agendaDay,listWeek prev,next'
                },
                buttonIcons: {
                    prev: 'md-left-single-arrow',
                    next: 'md-right-single-arrow',
                    prevYear: 'md-left-double-arrow',
                    nextYear: 'md-right-double-arrow'
                },
                buttonText: {
                    today: ' ',
                    month: ' ',
                    week: ' ',
                    day: ' '
                },
                windowResize: function(view) {
                    altair_fullcalendar.responsive();
                    $('#calendar_selectable').fullCalendar('option', 'height', ($(window).height() - 30));
                },
                navLinks: true,
                aspectRatio: 2.1,
                defaultDate: moment(),
                eventLimit: true,
                timeFormat: 'h:mm',
                loading: function(bool) {
                    if (bool) {
                        altair_helpers.content_preloader_show();
                    } else {
                        altair_helpers.content_preloader_hide();
                    }
                },
                eventClick: function(calEvent, jsEvent, view) {
                  var $this = $(".md-card-overlay-toggler");
                  $this
                      .html('&#xE5CD;')
                      .closest('.md-card').removeClass('md-card-overlay-active');
                      
                    $("#event-title").text(calEvent.title);
                    $("#start-time").text(calEvent.startTime);
                    $("#end-time").text(calEvent.endTime);
                    $("#type-exam-name").text(calEvent.typeExamName);
                    $("#course-name").text(calEvent.courseName);
                    $("#date").text(calEvent.date);

                    if (!$this.closest('.md-card').hasClass('md-card-overlay-active')) {
                        $this
                            .html('&#xE5CD;')
                            .closest('.md-card').addClass('md-card-overlay-active');

                    } else {
                        $this
                            .html('&#xE5CD;')
                            .closest('.md-card').removeClass('md-card-overlay-active');
                    }
                },
                events: function(start, end, timezone, callback) {
                    $.ajax({
                        url: Routing.generate('exam_date_json_student_space'),
                        dataType: 'json',
                        data: {
                            // our hypothetical feed requires UNIX timestamps
                            start: start.unix(),
                            end: end.unix()
                        },
                        success: function(data) {
                            var events = [];
                            $.each(data, function(i, item) {
                                events.push({
                                    title: item.title,
                                    start: item.date + "T" + item.startTime, // will be parsed
                                    end: item.date + "T" + item.endTime,
                                    date: item.date,
                                    courseName: item.courseName,
                                    typeExamName: item.typeExamName,
                                    startTime: item.startTime,
                                    endTime: item.endTime
                                });
                            });
                            callback(events);
                        }
                    });
                }
            });
            altair_fullcalendar.responsive();
            $('#calendar_selectable').fullCalendar('option', 'height', ($(window).height() - 30));
        }
    }
};
